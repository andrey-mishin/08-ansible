## Домашнее задание к занятию "08.02 Работа с Playbook. Доработка №1"

### Подготовка инфраструктуры 
Учёл замечания и поднял две виртуальные машины **centos-7** с помощью **Vagrant**.  
В этот раз использовал стандартного пользователя *vagrant* и его ключи ssh.

### Результат
- Итоговый *inventory/prod.yml* стал выглядеть так:
```
---
clickhouse:
  hosts:
    clickhouse-01:
      ansible_port: 2022
      ansible_user: vagrant
      ansible_host: localhost
      ansible_connection: ssh
      ansible_ssh_private_key_file: /home/baloo/.git/08-ansible-02-playbook/.vagrant/machines/clickhouse/virtualbox/private_key
vector:
  hosts:
    vector-01:
      ansible_port: 2122
      ansible_user: vagrant
      ansible_host: localhost
      ansible_connection: ssh
      ansible_ssh_private_key_file: /home/baloo/.git/08-ansible-02-playbook/.vagrant/machines/vector/virtualbox/private_key
```
- В playbook *site.yml* в *play* касающегося устновки вектора измененилось только название хоста с *clickhouse* на *vector*.

- Добавил отдельную директорию и файл *vars.yml* для переменных *vector* в директории *group_vars*.
Содержимое файла *group_vars/vector/vars.yml*
```
---
vector_version: "0.22.3"
```
Соответственно, из файла переменных **clickhouse** удалил информацию о версии **vector**.  

### Итог
Не понял какой вывод линтера нужно приложить.  
При запуске *ansible-lint site.yml* вывод пустой.

На всякий случай приложу результаты выполнения *playbook* первый раз и повторно.


- Вывод первоначального выполнения *playbook*:
```
baloo@pc:~/.git/08-ansible-02-playbook$ ansible-playbook -i inventory/prod.yml site.yml --ask-become-pass
BECOME password: 

PLAY [Install Clickhouse] *****************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Get clickhouse distrib] *************************************************************************************************************************************************************************************
changed: [clickhouse-01] => (item=clickhouse-client)
changed: [clickhouse-01] => (item=clickhouse-server)
failed: [clickhouse-01] (item=clickhouse-common-static) => {"ansible_loop_var": "item", "changed": false, "dest": "./clickhouse-common-static-22.3.3.44.rpm", "elapsed": 0, "item": "clickhouse-common-static", "msg": "Request failed", "response": "HTTP Error 404: Not Found", "status_code": 404, "url": "https://packages.clickhouse.com/rpm/stable/clickhouse-common-static-22.3.3.44.noarch.rpm"}

TASK [Get clickhouse distrib] *************************************************************************************************************************************************************************************
changed: [clickhouse-01]

TASK [Install clickhouse packages] ********************************************************************************************************************************************************************************
changed: [clickhouse-01]

TASK [Flush handlers] *********************************************************************************************************************************************************************************************

RUNNING HANDLER [Start clickhouse service] ************************************************************************************************************************************************************************
changed: [clickhouse-01]

TASK [Pause 3 seconds waiting for the clickhouse-server to start] *************************************************************************************************************************************************
Pausing for 3 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [clickhouse-01]

TASK [Create database] ********************************************************************************************************************************************************************************************
changed: [clickhouse-01]

PLAY [Install Vector] *********************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Download Vector] ********************************************************************************************************************************************************************************************
changed: [vector-01]

TASK [Install Vector] *********************************************************************************************************************************************************************************************
changed: [vector-01]

RUNNING HANDLER [Start Vector] ************************************************************************************************************************************************************************************
changed: [vector-01]

PLAY RECAP ********************************************************************************************************************************************************************************************************
clickhouse-01              : ok=6    changed=4    unreachable=0    failed=0    skipped=0    rescued=1    ignored=0   
vector-01                  : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```

- Вывод повторного выполнения *playbook*:
```
baloo@pc:~/.git/08-ansible-02-playbook$ ansible-playbook -i inventory/prod.yml site.yml --ask-become-pass
BECOME password: 

PLAY [Install Clickhouse] *****************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Get clickhouse distrib] *************************************************************************************************************************************************************************************
ok: [clickhouse-01] => (item=clickhouse-client)
ok: [clickhouse-01] => (item=clickhouse-server)
failed: [clickhouse-01] (item=clickhouse-common-static) => {"ansible_loop_var": "item", "changed": false, "dest": "./clickhouse-common-static-22.3.3.44.rpm", "elapsed": 0, "gid": 1000, "group": "vagrant", "item": "clickhouse-common-static", "mode": "0664", "msg": "Request failed", "owner": "vagrant", "response": "HTTP Error 404: Not Found", "secontext": "unconfined_u:object_r:user_home_t:s0", "size": 246310036, "state": "file", "status_code": 404, "uid": 1000, "url": "https://packages.clickhouse.com/rpm/stable/clickhouse-common-static-22.3.3.44.noarch.rpm"}

TASK [Get clickhouse distrib] *************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Install clickhouse packages] ********************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Flush handlers] *********************************************************************************************************************************************************************************************

TASK [Pause 3 seconds waiting for the clickhouse-server to start] *************************************************************************************************************************************************
Pausing for 3 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [clickhouse-01]

TASK [Create database] ********************************************************************************************************************************************************************************************
ok: [clickhouse-01]

PLAY [Install Vector] *********************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Download Vector] ********************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Install Vector] *********************************************************************************************************************************************************************************************
ok: [vector-01]

PLAY RECAP ********************************************************************************************************************************************************************************************************
clickhouse-01              : ok=5    changed=0    unreachable=0    failed=0    skipped=0    rescued=1    ignored=0   
vector-01                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```
